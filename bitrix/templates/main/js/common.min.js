$(document).ready(function() {

    /* ============= INDEX =============*/

    // $('#mp__product__new').on('initialized.owl.carousel', function(e) {
    //     $(this).parents('.tab_item').hide();

    // });
    // $('#mp__product__action').on('initialized.owl.carousel', function(e) {
    //     $(this).parents('.tab_item').hide();

    // });
    // $('#mp__product__popular').on('initialized.owl.carousel', function(e) {
    //     $(this).parents('.tab_item').addClass('ac');

    // });


    // $('.owl-theme-product').on('resize.owl.carousel', function(e) {
    //     $('.tab_item').show();
    //     setTimeout(function() {
    //         $('.owl-theme-product').parents('.tab_item').not('.ac').hide();
    //     }, 10);
    // });



    $('.call_time').wickedpicker({
        title: 'Время звонка', //The Wickedpicker's title,
        twentyFour : true,
    });
    $(".phone").mask("+7 (999) 999-99-99");


    $('.addphone').click(function(){
        $(".ph").append('<div class="phone-add first"><div class="inp phone"><input class="phone" type="text"></div></div>');
        $(".phone").mask("+7 (999) 999-99-99");
        return false;
    });

    $('#order_form_btn').on('click',function(){

        var number = '';
        $('.inp input.phone').each(function(i,el){
          if($(el).val()){
              number += $(el).val()+'; ';
          }
        });
        $('.phone_hidden').val(number);
        $('#order_form').submit();
        return false;
    });

    // Решение для jQuery
    $(document).ready(function(){
        $('.name').keyup(function(){
            var login            = $(this).val();
            var shablon            = /[А-Яа-я+A-Za-z\s]{1,50}/;
            var resultCheck        = login.match(shablon);
            if (resultCheck==login && resultCheck!=null){
                //$('#info').text("");
            }
            else{
                var kolich= login.length;
                //$('#info').text("Разрешены  буквы");
                login = login.slice(0,kolich-1);
                $(this).val(login);
            }
        });
    });/*end ready*/



    $('#mp__slider').slick({
        slidesToShow: 1,
        slidesToScroll: 1,
        arrows: false,
        dots: true,
        autoplay: true,
        autoplaySpeed: 2000
    });



    if(!$('.mp__products').length){

        if($('.ct__content').length){

            $('.slider_product').slick({
                slidesToShow: 4,
                slidesToScroll: 1,
                arrows: true,
                dots: false,
                responsive: [
                    {
                        breakpoint: 1319,
                        settings: {
                            arrows: true,
                            slidesToShow: 3
                        }
                    },
                    {
                        breakpoint: 1019,
                        settings: {
                            arrows: true,
                            slidesToShow: 3
                        }
                    }
                    ,
                    {
                        breakpoint: 660,
                        settings: {
                            arrows: true,
                            slidesToShow: 1
                        }
                    }
                ]
            })


        }
    }

    $('.slider_product.articles').slick({
        slidesToShow: 4,
        slidesToScroll: 1,
        arrows: true,
        dots: false,
        responsive: [
            {
                breakpoint: 1319,
                settings: {
                    arrows: true,
                    slidesToShow: 3
                }
            },
            {
                breakpoint: 1019,
                settings: {
                    arrows: true,
                    slidesToShow: 3
                }
            }
            ,
            {
                breakpoint: 660,
                settings: {
                    arrows: true,
                    slidesToShow: 1
                }
            }
        ]
    })

    $('.col-show-slides-6 .slider_product_show_all').slick({
        slidesToShow: 6,
        slidesToScroll: 1,
        arrows: true,
        dots: false,
        responsive: [
            {
                breakpoint: 1319,
                settings: {
                    arrows: true,
                    slidesToShow: 3
                }
            },
            {
                breakpoint: 1019,
                settings: {
                    arrows: true,
                    slidesToShow: 3
                }
            }
            ,
            {
                breakpoint: 660,
                settings: {
                    arrows: true,
                    slidesToShow: 1
                }
            }
        ]
    })
    

    


    $('.mp__products .tab_content .tab_item.ac .slider_product').slick({
        slidesToShow: 6,
        slidesToScroll: 1,
        arrows: true,
        dots: true,
        responsive: [
            {
                breakpoint: 1319,
                settings: {
                    arrows: false,
                    slidesToShow: 5
                }
            },
            {
                breakpoint: 1019,
                settings: {
                    arrows: false,
                    slidesToShow: 3
                }
            }
        ]
    })


    $(document).on('click', '.mp__products .tab', function(){

        var clicked  = $(this)
        var tab_item = $('.mp__products .tab_content .tab_item').eq(clicked.index())

        if(!clicked.hasClass('active')){

            $('.mp__products .tab.active').removeClass('active')
            clicked.addClass('active')

             $('.mp__products .tab_item.ac').fadeOut('fast', function(){

                $(this).removeClass('ac')

                tab_item.css('display', 'block')

                if(!tab_item.find('.slick-initialized').length){
                    tab_item.find('.slider_product').slick({
                        slidesToShow: 6,
                        slidesToScroll: 1,
                        arrows: true,
                        dots: true,
                        responsive: [
                            {
                                breakpoint: 1319,
                                settings: {
                                    arrows: false,
                                    slidesToShow: 5
                                }
                            },
                            {
                                breakpoint: 1019,
                                settings: {
                                    arrows: false,
                                    slidesToShow: 3
                                }
                            }
                        ]
                    })
                }
                tab_item.animate({opacity: 1}, {duration: 500, complete: function(){
                     tab_item.addClass('ac')
                }})
            })
        }
    })

    $(".tabitem").not(":first").hide();

    /*

    $(".mp__products .tab").click(function() {
        $(".tab_item.ac").removeClass('ac');
        $(".mp__products .tab").removeClass("active").eq($(this).index()).addClass("active");
        $(".tab_item").hide().eq($(this).index()).css('display', 'block').animate({opacity: 1},{duration: 300}).addClass('ac')
    }).eq(0).addClass("active");


    
    $(".tab_item").not(":first").css('opacity', '0');
    $(".tab_item").not(":first").css('display', 'none');

   */ 


    $(".tabslist .maincategory").click(function(e) {

        if(!$(this).hasClass('maincategory maincategory--3')){
            e.preventDefault()

            $(".tabslist .maincategory").removeClass("active").eq($(this).index()).addClass("active");
            $(".tabitem").hide().eq($(this).index()).fadeIn()
        }else{
            document.location.href = '/price/';
        }

        

    }).eq(0).addClass("active");

    $(document).on('click', '.menu__trigger', function(e) {
        e.preventDefault();

        var clicked = $(this);

        if (clicked.hasClass('close')) {
            clicked.removeClass('close');
            $('.mm__wrap').removeClass('show');

            $('body').removeClass('over');
        } else {
            clicked.addClass('close');
            $('.mm__wrap').addClass('show');

            $('body').addClass('over');

        }
    });


    /* ============= PROD_CARD =============*/

    $(document).on('click', '.pg-thumbnails > .item', function(e) {
        e.preventDefault()

        var thumb = $(this)
        var index = thumb.index()
        var curpic = $('.pg-current > a').eq(index)

        if (!thumb.hasClass('active')) {
            $('.pg-thumbnails > .item.active').removeClass('active')
            thumb.addClass('active')
            $('.pg-current > a').removeClass('active')
            curpic.addClass('active')
        } 
    }) 

    var pc_tab = $('.t-content > .tab')
    pc_tab.on('click', function() {
        $(this).toggleClass('m_active');
    });

    var vc = $('.vc-block')
    vc.slick({
        vertical: true,
        slidesToShow: 4,
        appendArrows: ('.vc-ctrl'),
        responsive: [
         {
           breakpoint: 1019,
           settings: {
            vertical: false,
             slidesToShow: 3
           }
         },
         {
           breakpoint: 659,
           settings: {
             vertical: false,
             slidesToShow: 1
           }
         }
       ] 
    });


    /* ============= CATALOG =============*/


    $('.cat > .name').on('click', function() {
        $(this).parent().toggleClass('open')
    });

    $('.cat .cat-ul .cat-li .title').on('click', function() {
        $(this).parent().toggleClass('li-open')
    });

    $('.cat .cat-ul .cat-li .inner a.underline').parent().parent().parent().parent().addClass('open');
    $('.cat .cat-ul .cat-li a.underline').parent().parent().parent().addClass('open');
    $('.cat .cat-ul .cat-li .inner a.underline').parent().parent().addClass('li-open');

    $('#select1').selectmenu({
        select: function( event, ui ) {
            window.location.href = "?ELEMENT_SORT_FIELD=" + ui.item.value;
        }
    })
    $('#select_prh').selectmenu({
        select: function( event, ui ) {
            window.location.href = "?ELEMENT_SORT_FIELD=" + ui.item.value;
        }
    })

    $('#quan').selectmenu({
        select: function( event, ui ) {
            window.location.href = "?PAGE_ELEMENT_COUNT=" + ui.item.value;
        }
    })
    $('#quan_b').selectmenu({
        select: function( event, ui ) {
            window.location.href = "?PAGE_ELEMENT_COUNT=" + ui.item.value;
        }
    })


    $('.products_roll > .pr_header > .view > a').on('click', function() {
        $(this).parent().children('a').toggleClass('active')
    });

    if (window.matchMedia("(min-width: 660px)").matches){


        $('.products_roll  .pr_box  .item  .hover  .inner .add2cart').on('click', function() {
            $(this).closest('.item').addClass('add2cart2');
        });

        $('.products_roll  .pr_box  .item  .hover  .inner .close').on('click', function() {
            $(this).closest('.item').removeClass('add2cart2');
        });

    }



    /*
    var $range = $(".js-range-slider"),

   // $inputFrom = $(".js-input-from"),
   // $inputTo = $(".js-input-to"),
    instance,
    min = 0,
    max = 456890,
    from = 0,
    to = 0;

    $range.ionRangeSlider({
        type: "double",
        min: min,
        max: max,
        from: 2500,
        to: 456890,
        hide_from_to: true,
        onStart: updateInputs,
        onChange: updateInputs
    });
    instance = $range.data("ionRangeSlider");

    function updateInputs (data) {
        from = data.from;
        to = data.to;

        $inputFrom.prop("value", from);
        $inputTo.prop("value", to); 
    }

    $inputFrom.on("input", function () {
        var val = $(this).prop("value");

        // validate
        if (val < min) {
            val = min;
        } else if (val > to) {
            val = to;
        }
        
        instance.update({
            from: val
        });
    });

    $inputTo.on("input", function () {
        var val = $(this).prop("value");

        // validate
        if (val < from) {
            val = from;
        } else if (val > max) {
            val = max;
        }
        
        instance.update({
            to: val
        });
    });

    */

    // 640

    var a = $('.ct__mask')
    var b = $('.products_roll .filter')

    b.on('click', function() {
        $('.ct__leftbar').toggleClass('active')
        $('.ct__content').toggleClass('active')
        $('.filter').toggleClass('change')
        $('.ct__mask').toggleClass('active')
    });

    a.on('click', function() {
        $('.ct__leftbar').removeClass('active')
        $('.ct__content').removeClass('active')
        $('.filter').removeClass('change')
        $('.ct__mask').removeClass('active')
    });


    /* ============= LOGIN =============*/

    $('.login_reg.log').on('click', function() {
        $('.row.login').addClass('user_reg')
    });
    $('.back2enter').on('click', function() {
        $('.row.login').removeClass('user_reg')
    });


    /* ============= ACCOUNT =============*/

    $('.lk_sandwich').on('click', function() {
        $(this).toggleClass('exx')
        $('.lk_leftbar').toggleClass('show')
    });


    /* ============= ORDERING =============*/

    $('.login_reg.ord').on('click', function() {
        $('.or__content.s1').addClass('user_reg')
    });
    $('.back2enter').on('click', function() {
        $('.or__content.s1').removeClass('user_reg')
    });

    $( "#date" ).datepicker( $.datepicker.regional[ "ru" ]);



    /* ============= CONTACTS =============*/

    $('.sandwich').on('click', function() {
        $('.co__sandwich > .sandwich').toggleClass('exx')
        $('.t-list').toggleClass('show')
    });


    /* ============= PROD_CARD =============*/

    $(document).on('click', '.pc__tabs > .t-list > a', function(e) {
        e.preventDefault()

        var tab = $(this)
        var index = tab.index()
        var curtab = $('.t-content > .tab').eq(index)

        if (!tab.hasClass('active')) {
            $('.pc__tabs > .t-list > a.active').removeClass('active')
            tab.addClass('active')
            $('.t-content > .tab.active').removeClass('active')
            curtab.addClass('active')
        } 
    })  


    $(document).on('click', '.quantity a', function(e){
        e.preventDefault()

        var clicked = $(this)
        var parent = clicked.parents('.quantity')
       ;

        if(clicked.hasClass('minus')){
            if(parseInt(parent.find('input').val())-1 > 0){
                parent.find('input').val(parseInt(parent.find('input').val())-1);
            }
        }else{
           parent.find('input').val(parseInt(parent.find('input').val())+1);
        }

        if(parseInt(parent.find('input').val()) > 1){
            parent.find('.minus').removeClass('na');
        }else{
            parent.find('.minus').addClass('na');
        }

    })


    // Табы на страние «Контакты»
    $(document).on('click', '.co__tabs .t-list a', function(e){

        e.preventDefault()
        var clicked = $(this)
        var index = $(this).index()
        var city = $(this).parents('.city')

        if(!clicked.hasClass('active')){
            city.find('.co__tabs .t-list a.active').removeClass('active')
            clicked.addClass('active')

            city.find('.co__tabs .t-content .tab.active').removeClass('active')
            city.find('.co__tabs .t-content .tab').eq(index).addClass('active')
        }
    })

    $(document).on('click', '.co__cities a', function(e){
        e.preventDefault()
        var clicked = $(this)
        var index = $(this).index()

        if(!clicked.hasClass('active')){
            $('.co__cities a.active').removeClass('active')
            clicked.addClass('active')

            $('.co__cities-list .city.active').removeClass('active')
            $('.co__cities-list .city').eq(index).addClass('active')
        }
    })

    // END :: Табы на страние «Контакты»

    // Табы на страние «Доставка»

    $(document).on('click', '.sh__cities a', function(e){
        e.preventDefault()

        var clicked = $(this)
        var index = clicked.index()

        console.log($('.delivery__areas .area').eq(index));


        if(!clicked.hasClass('active')){
            $('.sh__cities a.active').removeClass('active')
            clicked.addClass('active')

            $('.delivery__areas .area-item.active').removeClass('active')
            $('.delivery__areas .area-item').eq(index).addClass('active')
        }
    })

    // END :: Табы на страние «Доставка»

    $(document).on('click', '.show-popup', function(e){
        e.preventDefault()
        var clicked = $(this)

        $('.popup#'+clicked.data('id')).velocity('fadeIn', 'fast')
    })

    $(document).on('click', '.popup .close', function(e){
        e.preventDefault()
        var clicked = $(this)
        clicked.parent().velocity('fadeOut', 'fast')
    })



    $(document).on('click', '.catalog-sections-menu ul li .dd', function(e){
        e.preventDefault()

        var clicked = $(this)
        var parent  = $(this).parent('li')

        if(!parent.hasClass('active')){
            clicked.html('-')
            parent.addClass('active')
            parent.children('ul').velocity('slideDown', 'fast')
        }else{
            clicked.html('+')
            parent.removeClass('active')
            parent.children('ul').velocity('slideUp', 'fast')
        }
    })

    $(document).on('change', '.pr_box .item .compare input', function(){

        var elem   = $(this)
        var parent = elem.parents('.compare')
        var id = elem.val();
        var sec_id = elem.attr('id-cat');
        var url = "/catalog/compare/";


        if(elem.prop('checked')){
            $.getJSON("/ajax/check-section-compare.php", {action:"CHECK_SECTION_COMPARE", sec_id: sec_id})
                .done(function(data){
                    if(data.error == true){
                        alertify.error("Невозможно сравнение товаров разных типов.");
                        return false;
                    }else{
                        $.get(url, {action:"ADD_TO_COMPARE_LIST", id: id});
                        alertify.success("Товар успешно добавлен в сравнение.");
                        parent.find('span').html('<a href="/catalog/compare/">Перейти</a>');
                    }
                });
        }else{
            $.get(url, {action:"DELETE_FROM_COMPARE_LIST", id: id});
            alertify.success("Товар успешно удален из сравнения.");
            parent.find('span').html('Сравнить');
        }

    })

    $(document).on('change', '.bb_compare input', function(){

        var elem   = $(this)
        var parent = elem.parents('.bb_compare')
        var id = elem.val();
        var sec_id = elem.attr('id-cat');
        var url = "/catalog/compare/";


        if(elem.prop('checked')){
            $.getJSON("/ajax/check-section-compare.php", {action:"CHECK_SECTION_COMPARE", sec_id: sec_id})
                .done(function(data){
                    if(data.error == true){
                        alertify.error("Невозможно сравнение товаров разных типов.");
                        return false;
                    }else{
                        $.get(url, {action:"ADD_TO_COMPARE_LIST", id: id});
                        alertify.success("Товар успешно добавлен в сравнение.");
                        parent.find('label').html('<a href="/catalog/compare/">Перейти к сравнению</a>');
                    }
                });
        }else{
            $.get(url, {action:"DELETE_FROM_COMPARE_LIST", id: id});
            alertify.success("Товар успешно удален из сравнения.");
            parent.find('label').html('Сравнить');
        }

    })


    if($('.compare-items').length){
        if (window.matchMedia("(min-width: 1019px)").matches){
            $('.compare-items').kinetic({ x: true, y: false})
        }else{
            $('.compare-page .inn').kinetic({ x: true, y: false})
        }
    }

    $(".methods_detail .group.store").remove();
    $.get( "/ajax/delivery_store.php", { DELIVERY_ID: $('.or__content .methods .meth').find('input:checked').attr('id-store'),ID_FIELD: $('.or__content .methods .meth').find('input:checked').attr('id-field') } ).done(
        function( data ) {
            $('.methods_detail').prepend(data);
            if(data){
                $(".methods_detail .group.personal_data_fis").fadeOut();
                $(".methods_detail .group.date_time_fis").fadeOut();
            }
        });
    

    $(document).on('click', '.or__content .methods .meth', function(e){
        e.preventDefault()



        var clicked =  $(this)
        var index   =  clicked.index()
        var newTab     =  $('.or__content .methods_detail .tab-content').eq(index)
        var curTab     =  $('.or__content .methods_detail .tab-content.active')



        if(!clicked.hasClass('active')){
            $('.or__content .methods .meth.active').removeClass('active')
            clicked.addClass('active')


            curTab.css('position', 'absolute')
            curTab.css('left', '0')
            curTab.css('top', '0')

            newTab.css('display', 'block')
            newTab.css('opacity', '0')

            curTab.velocity({ opacity: 0 }, { duration: 300, complete: function(){

                curTab.removeClass('active')
                curTab.css('display', 'none')

            } } )

            newTab.velocity({opacity: 1}, {duration: 300, complete: function(){

                curTab.css('position', 'static')
                newTab.addClass('active')

            }})

            /*
                curTab.removeClass('active')
                newTab.velocity('fadeIn', 'fast', function(){
                    newTab.addClass('active')
                })

            */
           


        }

        $(".methods_detail .group.personal_data_fis").fadeIn();
        $(".methods_detail .group.date_time_fis").fadeIn();

        $('.or__content .methods .meth input').prop('checked', false);
        if(clicked.hasClass('active')){

            clicked.find('input').prop('checked', true);
            $(".methods_detail .group.store").remove();
            $.get( "/ajax/delivery_store.php", { DELIVERY_ID: clicked.find('input:checked').attr('id-store'),ID_FIELD: clicked.find('input:checked').attr('id-field') } ).done(
                function( data ) {
                    $('.methods_detail').prepend(data);
                    if(data){
                        $(".methods_detail .group.personal_data_fis").fadeOut();
                        $(".methods_detail .group.date_time_fis").fadeOut();
                    }
                });
        }
    })





    $(document).on('click', '.or__content .payment_types .type', function(e){

        $('.or__content .payment_types .type').each(function(i,el){
            $(el).removeAttr('style');
        });

        var clicked = $(this);
        clicked.css('border','5px solid #000');
        clicked.find('input').prop('checked', true);
        return false;
    })




    


});